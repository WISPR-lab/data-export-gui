manifest_version: 1
id: facebook
name: "Facebook"
last_updated: "2025-11-24"


data_types:

# LOGIN EVENTS
- temporal: "event" 
  category: "auth.login.success"
  files:
  - path: "security_and_login_information/account_activity.json"
    parser: 
      format: "json"
      json_root: "account_activity_v2[]" # find the list of dicts to parse
      filter: {field: "action", op: "==", value: "Login"}
    fields:
    - {name: "primary_timestamp", source: "timestamp", type: "datetime"}
    - {name: "ip", source: "ip_address", type: "string"}
    - {name: "user_agent", source: "user_agent", type: "string"}
    - {name: "cookie_redacted", source: "datr_cookie", type: "string"}

  - path: "security_and_login_information/logins_and_logouts.json"
    parser: 
      format: "json"
      json_root: "account_accesses_v2[]"
      filter: {field: "action", op: "==", value: "Login"}
    fields:
    - {name: "primary_timestamp", source: "timestamp", type: "datetime"}
    - {name: "ip", source: "ip_address", type: "string"}

# AUTH CHECKPOINT INITIATE
- temporal: "event" 
  category: "auth.checkpoint.initiate"
  files:
  - path: "security_and_login_information/record_details.json"
    parser: 
      format: "json" # ok for nested dictionaries within dictionaries, but not nested lists
      json_root: "admin_records_v2[]"
      filter:
        logic: "any"
        conditions:
        - {field: "event", op: "==", value: "Checkpoint"}
        - {field: "event", op: "startswith", value: "Checkpoint:*"}
        - {field: "event", op: "==", value: "Two-factor authentication"}
    fields: 
    - {name: "primary_timestamp", source: "session.created_timestamp", type: "datetime"}
    - {name: "ip", source: "session.ip_address", type: "string"}
    - {name: "user_agent", source: "session.user_agent", type: "string"}
    - {name: "cookie_redacted", source: "session.datr_cookie", type: "string"}


# AUTH CHECKPOINT PASS
- temporal: "event" 
  category: "auth.checkpoint.pass"
  files:
  - path: "security_and_login_information/record_details.json"
    parser: 
      format: "json" 
      json_root: "admin_records_v2[]"
      filter: {field: "event", op: "==", value: "Checkpoint Passed"}
    fields: 
    - {name: "primary_timestamp", source: "session.created_timestamp", type: "datetime"}
    - {name: "ip", source: "session.ip_address", type: "string"}
    - {name: "user_agent", source: "session.user_agent", type: "string"}
    - {name: "cookie_redacted", source: "session.datr_cookie", type: "string"}

  
# LOGOUT EVENTS
- temporal: "event" 
  category: "auth.logout"
  files:
  # account_activity
  - path: "security_and_login_information/account_activity.json"
    parser:
      format: "json"
      json_root: "account_activity_v2[]"
      filter: {field: "action", op: "==", value: "Log out"}
    fields:
    - {name: "primary_timestamp", source: "timestamp", type: "datetime"}
    - {name: "ip", source: "ip_address", type: "string"}
    - {name: "user_agent", source: "user_agent", type: "string"}
    - {name: "cookie_redacted", source: "datr_cookie", type: "string"}
  
  # logins_logouts
  - path: "security_and_login_information/logins_and_logouts.json"
    parser: 
      format: "json"
      json_root: "account_accesses_v2[]"
      filter: {field: "action", op: "==", value: "Log out"}
    fields:
    - {name: "primary_timestamp", source: "timestamp", type: "datetime"}
    - {name: "ip", source: "ip_address", type: "string"}
    - {name: "user_agent", source: "user_agent", type: "string"}
    - {name: "cookie_redacted", source: "datr_cookie", type: "string"}



# PASSWORD CHANGE EVENTS
- temporal: "event" 
  category: "auth.pwd.change"
  files:
  - path: "security_and_login_information/account_activity.json"
    parser:
      format: "json"
      json_root: "account_activity_v2[]"
      filter: {field: "action", op: "==", value: "Password Change"}
    fields:
    - {name: "primary_timestamp", source: "timestamp", type: "datetime"}
    - {name: "ip", source: "ip_address", type: "string"}
    - {name: "user_agent", source: "user_agent", type: "string"}
    - {name: "cookie_redacted", source: "datr_cookie", type: "string"}

  - path: "security_and_login_information/record_details.json"
    parser:
      format: "json"
      json_root: "admin_records_v2[]"
      filter: {field: "event", op: "==", value: "Password Change"}
    fields:
    - {name: "primary_timestamp", source: "session.created_timestamp", type: "datetime"}
    - {name: "ip", source: "session.ip_address", type: "string"}
    - {name: "user_agent", source: "session.user_agent", type: "string"}
    - {name: "cookie_redacted", source: "session.datr_cookie", type: "string"}

# PASSWORD RESET EVENTS
- temporal: "event" 
  category: "auth.pwd.reset_request"
  files:
  - path: "security_and_login_information/account_activity.json"
    parser:
      format: "json"
      json_root: "account_activity_v2[]"
      filter: {field: "action", op: "==", value: "Requested Password Reset"}
    fields:
    - {name: "primary_timestamp", source: "timestamp", type: "datetime"}
    - {name: "ip", source: "ip_address", type: "string"}
    - {name: "user_agent", source: "user_agent", type: "string"}
    - {name: "cookie_redacted", source: "datr_cookie", type: "string"}


# RECOVERY/LEGACY CONTACT EVENTS
- temporal: "event" 
  category: "auth.primary_email.addition"
  files:
    - path: "security_and_login_information/account_activity.json"
      parser:
        format: "json"
        json_root: "account_activity_v2[]"
        filter: {field: "action", op: "==", value: "Email Added"}
      fields:
      - {name: "primary_timestamp", source: "timestamp", type: "datetime"}
      - {name: "ip", source: "ip_address", type: "string"}
      - {name: "user_agent", source: "user_agent", type: "string"}
      - {name: "cookie_redacted", source: "datr_cookie", type: "string"}

    # record_details
    - path: "security_and_login_information/record_details.json"
      parser:
        format: "json"
        json_root: "admin_records_v2[]"
        filter: {field: "event", op: "==", value: "Email Added"}
      fields:
      - {name: "primary_timestamp", source: "session.created_timestamp", type: "datetime"}
      - {name: "ip", source: "session.ip_address", type: "string"}
      - {name: "user_agent", source: "session.user_agent", type: "string"}
      - {name: "cookie_redacted", source: "session.datr_cookie", type: "string"}



# DATA TAKEOUT EVENTS
- temporal: "event"
  category: "data_takeout.request"
  files:
  - path: "your_facebook_activity/other_activity/your_information_download_requests.json"
    parser:
      # format: "json"
      format: "json_label_values"
      json_root: "[]"
    fields:
    - {name: "primary_timestamp", source: "timestamp", type: "datetime"}



# ---------------------------------------------- #
# AUTHENTICATED DEVICES
- temporal: "state" 
  category: "auth.sessions"
  files:
  - path: "security_and_login_information/mobile_devices.json"
    parser: 
      format: "json"
      json_root: "devices_v2[]"
    fields:
    - { name: "last_timestamp", source: "update_time", type: "datetime" }
    - { name: "model_ver_code", source: "type", type: "string" }
    - { name: "os_ver", source: "os", type: "string" }
    - { name: "internal_device_id", source: ["push_tokens[0].device_id", "family_device_id"], type: "string", transform: "coalesce" }
    - { name: "fb_ad_id", source: "advertiser_id", type: "string" }

  - path: "personal_information/profile_information/your_devices.json"
    parser:
      format: "json_label_values"
      # format: "json"
      json_root: "[]"
    fields:
    - {name: "first_timestamp", source: "'Device ID details'.first_seen_time", type: "datetime"}
    - {name: "last_timestamp", source: "'Device ID details'.last_seen_time", type: "datetime"}
    - {name: "internal_device_id", source: "Device ID", type: "string"}
    - {name: "internal_hardware_id", source: "Hardware ID", type: "string"}
    - {name: "google_ad_id", source: "Google advertiser ID", type: "string"}
    - {name: "android_id", source: "Android ID", type: "string"}
    - {name: "os", source: "OS type", type: "string"}
    - {name: "os_ver", source: "OS version", type: "string"}
    - {name: "model_ver_code", source: "Device type", type: "string"}
    - {name: "user_agent", source: "User agent", type: "string"}
  
  - path: "security_and_login_information/recognized_devices.json"
    parser:
      format: "json"
      json_root: "recognized_devices_v2[]"
    fields:
    - { name: "first_timestamp", source: "created_timestamp", type: "datetime" }
    - { name: "last_timestamp", source: "updated_timestamp", type: "datetime" }
    - { name: "user_agent", source: "user_agent", type: "string" }
    - { name: "ip", source: "ip_address", type: "string" }
    - { name: "cookie_redacted", source: "datr_cookie", type: "string" }
    - { name: "app_info", source: "name", type: "string" }

  - path: "security_and_login_information/where_you're_logged_in.json"
    parser:
      format: "json"
      json_root: "active_sessions_v2[]"
    fields:
    - { name: "first_timestamp", source: "created_timestamp", type: "datetime" }
    - { name: "last_timestamp", source: "updated_timestamp", type: "datetime" }
    - { name: "user_agent", source: "user_agent", type: "string" }
    - { name: "ip", source: "ip_address", type: "string" }
    - { name: "cookie_redacted", source: "datr_cookie", type: "string" }
    - { name: "app_info", source: ["name", "app"], type: "string", transform: "coalesce" }
    - { name: "model_ver", source: "device", type: "string"}


# new data type: interval? 